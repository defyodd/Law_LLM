class ContractAgent:
    def answer(self, question: str) -> dict:
        # 检测是否为制作合同相关问题
        contract_creation_keywords = ["制作", "起草", "拟定", "编写", "撰写", "合同模板", "合同范本", "生成"]

        # 定义合同模板
        contract_templates = {
            "租赁合同": self._generate_lease_contract,
            "买卖合同": self._generate_sales_contract,
            "借款合同": self._generate_loan_contract,
            "劳动合同": self._generate_labor_contract,
            "服务合同": self._generate_service_contract
        }

        is_contract_creation = any(kw in question for kw in contract_creation_keywords)
        contract_type = next((ct for ct in contract_templates.keys() if ct in question), None)

        if is_contract_creation or any(kw in question for kw in ["合同", "协议"]):
            if contract_type:
                contract_content = contract_templates[contract_type]()
                return {
                    "agent": "ContractAgent",
                    "answer": f"已为您生成专业的{contract_type}：\n\n{contract_content}",
                    "confidence": 0.95,
                    "suggestions": [
                        "请根据实际情况修改当事人信息",
                        "建议法律专业人士审核后使用",
                        "可根据具体需求调整条款内容"
                    ],
                    "relevant_articles": ["《民法典》第三编 合同", "《民法典》第四百六十四条"],
                    "query_type": "合同生成",
                    "keywords": ["生成合同", contract_type],
                    "contract_content": contract_content,
                    "type": "write"  # 添加类型标识
                }
            else:
                return {
                    "agent": "ContractAgent",
                    "answer": "我可以为您生成以下类型的专业法律合同：\n• 租赁合同\n• 买卖合同\n• 借款合同\n• 劳动合同\n• 服务合同\n\n请明确您需要哪种类型的合同。",
                    "confidence": 0.8,
                    "suggestions": ["请选择具体的合同类型"],
                    "relevant_articles": [],
                    "query_type": "合同类型选择",
                    "keywords": ["合同生成"],
                    "type": "write"  # 添加类型标识
                }

        return {
            "agent": "ContractAgent",
            "answer": "我专门处理法律合同生成，请说明您需要生成的合同类型。",
            "confidence": 0.4,
            "suggestions": ["请明确合同生成需求"],
            "relevant_articles": [],
            "query_type": "其他",
            "keywords": [],
            "type": "chat"  # 非合同生成请求返回 chat 类型
        }

    def _generate_lease_contract(self) -> str:
        return """# 房屋租赁合同

## 合同双方

**甲方（出租方）：** _______________  
**地址：** _____________________  
**电话：** _____________________  

**乙方（承租方）：** _______________  
**地址：** _____________________  
**电话：** _____________________  

根据《民法典》相关规定，甲乙双方在平等自愿基础上达成如下协议：

## 第一条 租赁房屋情况
- **房屋地址：** _____________________
- **建筑面积：** _____________________
- **房屋用途：** _____________________

## 第二条 租赁期限
自____年____月____日起至____年____月____日止。

## 第三条 租金及支付方式
- **月租金：** 人民币____元
- **支付方式：** _____________________

## 第四条 押金
**押金金额：** 人民币____元

## 第五条 双方权利义务
甲方应保证房屋符合居住条件，乙方应按时支付租金并合理使用房屋。

## 第六条 违约责任
任何一方违约，应承担相应法律责任。

## 第七条 争议解决
本合同争议由房屋所在地法院管辖。

---

**甲方签字：** _______________  **日期：** _______________  
**乙方签字：** _______________  **日期：** _______________"""

    def _generate_sales_contract(self) -> str:
        return """# 买卖合同

## 合同双方

**甲方（卖方）：** _______________  
**地址：** _____________________  
**电话：** _____________________  

**乙方（买方）：** _______________  
**地址：** _____________________  
**电话：** _____________________  

根据《民法典》相关规定，甲乙双方就买卖事宜达成如下协议：

## 第一条 标的物
- **名称：** _____________________
- **规格：** _____________________
- **数量：** _____________________

## 第二条 质量标准
**质量要求：** _____________________

## 第三条 价款及支付
- **总价款：** 人民币____元
- **支付方式：** _____________________

## 第四条 交付
- **交付时间：** _____________________
- **交付地点：** _____________________

## 第五条 检验
买方应在收到货物____日内检验完毕。

## 第六条 违约责任
任何一方违约，应承担相应法律责任。

---

**甲方签字：** _______________  **日期：** _______________  
**乙方签字：** _______________  **日期：** _______________"""

    def _generate_loan_contract(self) -> str:
        return """# 借款合同

## 合同双方

**甲方（出借人）：** _______________  
**地址：** _____________________  
**电话：** _____________________  

**乙方（借款人）：** _______________  
**地址：** _____________________  
**电话：** _____________________  

根据《民法典》相关规定，甲乙双方就借款事宜达成如下协议：

## 第一条 借款金额
**借款金额：** 人民币____元（大写：_____）

## 第二条 借款期限
自____年____月____日起至____年____月____日止。

## 第三条 利率
**年利率：** _____%

## 第四条 还款方式
**还款方式：** _____________________

## 第五条 担保
**担保方式：** _____________________

## 第六条 违约责任
借款人逾期还款，应承担违约金。

---

**甲方签字：** _______________  **日期：** _______________  
**乙方签字：** _______________  **日期：** _______________"""

    def _generate_labor_contract(self) -> str:
        return """# 劳动合同

## 合同双方

**甲方（用人单位）：** _______________  
**地址：** _____________________  
**法定代表人：** _____________________  

**乙方（劳动者）：** _______________  
**地址：** _____________________  
**身份证号：** _____________________  

根据《劳动合同法》相关规定，甲乙双方达成如下协议：

## 第一条 合同期限
自____年____月____日起至____年____月____日止。

## 第二条 工作内容
- **工作岗位：** _____________________
- **工作地点：** _____________________

## 第三条 工作时间
每日工作____小时，每周工作____天。

## 第四条 劳动报酬
**月工资：** 人民币____元

## 第五条 社会保险
甲方依法为乙方缴纳社会保险。

## 第六条 违约责任
任何一方违约，应承担相应法律责任。

---

**甲方签字：** _______________  **日期：** _______________  
**乙方签字：** _______________  **日期：** _______________"""

    def _generate_service_contract(self) -> str:
        return """# 服务合同

## 合同双方

**甲方（委托方）：** _______________  
**地址：** _____________________  
**电话：** _____________________  

**乙方（服务方）：** _______________  
**地址：** _____________________  
**电话：** _____________________  

根据《民法典》相关规定，甲乙双方就服务事宜达成如下协议：

## 第一条 服务内容
- **服务项目：** _____________________
- **服务标准：** _____________________

## 第二条 服务期限
自____年____月____日起至____年____月____日止。

## 第三条 服务费用
- **服务费：** 人民币____元
- **支付方式：** _____________________

## 第四条 服务质量
乙方应按约定标准提供服务。

## 第五条 违约责任
任何一方违约，应承担相应法律责任。

---

**甲方签字：** _______________  **日期：** _______________  
**乙方签字：** _______________  **日期：** _______________"""